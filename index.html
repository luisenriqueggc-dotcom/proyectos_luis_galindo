<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PROYECTOS · Luis Galindo</title>
  <meta name="description" content="Repositorio de proyectos creativos con visor de PDFs y videos (Vimeo)" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=League+Spartan:wght@600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --sky-1: #5aa6ff;
      --sky-2: #1e6ee6;
      --sky-3: #0b3d9b;
      --text: #f8fbff;
      --panel: rgba(255,255,255,.10);
      --panel-border: rgba(255,255,255,.22);
      --grid-alpha: 0.6;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui;
      color:var(--text); background:linear-gradient(180deg, var(--sky-1) 0%, var(--sky-2) 55%, var(--sky-3) 100%);
      overflow-x:hidden;
    }
    /* Grid global */
    body::before{
      content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
      background:
        repeating-linear-gradient(to right, rgba(255,255,255,var(--grid-alpha)) 0 1px, transparent 1px 120px),
        repeating-linear-gradient(to bottom, rgba(255,255,255,var(--grid-alpha)) 0 1px, transparent 1px 120px);
    }

    .hero{ position:relative; min-height:40vh; display:flex; align-items:center; justify-content:center; padding:32px 16px 16px; z-index:1; }
    .hero-inner{ max-width:1100px; width:100%; text-align:center }
    .kicker{ letter-spacing:.16em; text-transform:uppercase; font-weight:800; opacity:.85; margin:0 0 8px 2px }
    .title{ font-family:"League Spartan", Inter, system-ui; font-size:clamp(48px, 12vw, 144px); line-height:.85; margin:0; letter-spacing:.02em; text-shadow:0 10px 30px rgba(0,0,0,.35) }
    .tagline{ font-size:clamp(14px, 2.6vw, 22px); margin:12px 0 24px; color:#dfeaff }

    .layout{ display:grid; grid-template-columns:320px 1fr; gap:16px; max-width:1100px; margin:-20px auto 28px; padding:0 20px; position:relative; z-index:1 }
    aside, main{ backdrop-filter:saturate(140%) blur(8px); background:var(--panel); border:1px solid var(--panel-border); border-radius:16px }

    .list-header{ padding:12px 14px; border-bottom:1px solid var(--panel-border); font-size:13px; color:#eaf2ff; display:flex; align-items:center; gap:8px }
    .search{ position:relative; flex:1 }
    .search input{ width:100%; padding:10px 12px 10px 36px; border-radius:10px; border:1px solid var(--panel-border); background:rgba(255,255,255,.06); color:#fff; outline:none }
    .search input::placeholder{ color:#eaf2ffcc }
    .search svg{ position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.75 }

    .list{ max-height:calc(100vh - 280px); overflow:auto }
    .item{ display:flex; gap:10px; padding:12px 14px; cursor:pointer; border-bottom:1px dashed rgba(255,255,255,.18); align-items:center }
    .item:hover{ background:rgba(255,255,255,.06) }
    .item.active{ background:rgba(255,255,255,.12) }
    .item .meta{ display:flex; flex-direction:column }
    .item .title{ font-size:14px; font-weight:700; line-height:1.3 }
    .item .sub{ font-size:12px; opacity:.8 }

    main{ min-height:70vh; display:flex; flex-direction:column; overflow:hidden }
    .viewer-bar{ display:flex; align-items:center; gap:8px; padding:10px; border-bottom:1px solid var(--panel-border); background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06)); }
    .viewer-bar .name{ font-size:14px; opacity:.9 }
    .viewer{ width:100%; min-height:calc(100vh - 280px); background:#0a1020; display:flex; align-items:stretch; justify-content:center }
    .viewer iframe, .viewer video{ width:100%; height:calc(100vh - 280px); border:0; background:#0a1020 }

    footer{ max-width:1100px; margin:8px auto 40px; padding:0 20px; color:#eaf2ff; font-size:12px; opacity:.9; position:relative; z-index:1; text-align:center }

    @media (max-width: 980px){
      .layout{ grid-template-columns:1fr }
      .viewer iframe, .viewer video{ height:60vh }
      aside{ order:2 } main{ order:1 }
    }
  </style>

  <!-- PDF.js (fallback para móviles/iOS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js" defer></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (window['pdfjsLib']) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js";
      }
    });
  </script>
</head>
<body>
  <section class="hero">
    <div class="hero-inner">
      <p class="kicker">Luis Galindo</p>
      <h1 class="title">PROYECTOS</h1>
      <p class="tagline">Aquí, las ideas toman vuelo — y a veces te llevan con ellas ✈️</p>
    </div>
  </section>

  <div class="layout">
    <aside>
      <div class="list-header">
        <span>Documentos</span>
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
            <path d="M21 21l-4.3-4.3m1.8-5.2a7 7 0 11-14 0 7 7 0 0114 0z" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <input id="search" type="search" placeholder="Buscar por nombre…" />
        </div>
      </div>
      <div class="list" id="list"></div>
    </aside>

    <main>
      <div class="viewer-bar">
        <div class="name" id="currentName">Selecciona un documento</div>
      </div>
      <div id="viewerContainer" class="viewer"></div>
    </main>
  </div>

  <footer>© 2025 Luis Galindo · Todos los derechos reservados</footer>

  <script>
    /* === Catálogo === */
    const DOCS = [
      { type: "pdf",   title: "Portafolio 2025 Luis Galindo", file: "pdfs/Portafolio_2025_Luis_Galindo.pdf" },
      { type: "pdf",   title: "BOOK 2024",                    file: "pdfs/BOOK_2024.pdf" },
      { type: "vimeo", title: "MORDISKO (Vimeo)",             file: "https://player.vimeo.com/video/1112778404?badge=0&autopause=0&player_id=0&app_id=58479" },
      { type: "vimeo", title: "Demo Vimeo #2",                file: "https://player.vimeo.com/video/825237364?h=521da1c17e" }
    ];

    /* === Utils (query params codificados) === */
    function getParam(name){
      const url = new URL(window.location.href);
      const v = url.searchParams.get(name);
      return v ? decodeURIComponent(v) : v;
    }
    function setParam(name, value){
      const url = new URL(window.location.href);
      if(value == null){ url.searchParams.delete(name); }
      else { url.searchParams.set(name, encodeURIComponent(value)); }
      history.replaceState({}, "", url);
    }

    const listEl = document.getElementById('list');
    const searchEl = document.getElementById('search');
    const currentNameEl = document.getElementById('currentName');
    const viewerContainer = document.getElementById('viewerContainer');

    let activeIndex = -1;

    function renderList(filter=""){
      listEl.innerHTML = "";
      const norm = filter.trim().toLowerCase();
      DOCS.forEach((doc, i) => {
        const text = (doc.title + " " + doc.file).toLowerCase();
        if(!norm || text.includes(norm)){
          const item = document.createElement('div');
          item.className = 'item';
          item.dataset.index = i;
          const sub = (doc.type === 'pdf')
            ? doc.file
            : (()=>{ try{ const u=new URL(doc.file); return u.hostname+u.pathname; }catch{ return doc.file; } })();
          item.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <path d="M7 3h7l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" stroke="currentColor" stroke-width="1.6"/>
              <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            <div class="meta">
              <div class="title">${doc.title}</div>
              <div class="sub">${sub}</div>
            </div>
          `;
          item.addEventListener('click', () => openDoc(i));
          listEl.appendChild(item);
        }
      });
      highlightActive();
      if(!listEl.children.length){
        const empty = document.createElement('div');
        empty.className = 'item';
        empty.innerHTML = '<div class="meta"><div class="title">Sin resultados</div><div class="sub">Intenta ajustar tu búsqueda</div></div>';
        listEl.appendChild(empty);
      }
    }

    function highlightActive(){
      [...listEl.children].forEach(el => el.classList.remove('active'));
      if(activeIndex >= 0){
        const el = [...listEl.children].find(n => Number(n.dataset.index) === activeIndex);
        if(el) el.classList.add('active');
      }
    }

    /* --- Detección simple de móviles/Safari para usar PDF.js --- */
    function isMobilePDFSensitive(){
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isiOS = /iPad|iPhone|iPod/.test(ua);
      const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
      return isiOS || isSafari;
    }

    async function renderPDFWithPDFJS(url){
      const container = document.getElementById('viewerContainer');
      container.innerHTML = ''; // limpiar

      if (!window['pdfjsLib']) {
        container.innerHTML = `<iframe src="${url}#zoom=page-width&toolbar=0&view=FitH" style="width:100%;height:100%;border:0;"></iframe>`;
        return;
      }

      const loading = document.createElement('div');
      loading.style.padding = '12px';
      loading.textContent = 'Cargando documento…';
      container.appendChild(loading);

      const pdf = await pdfjsLib.getDocument(url).promise;
      container.innerHTML = '';

      const pagesWrapper = document.createElement('div');
      pagesWrapper.style.width = '100%';
      pagesWrapper.style.display = 'flex';
      pagesWrapper.style.flexDirection = 'column';
      pagesWrapper.style.gap = '12px';
      container.appendChild(pagesWrapper);

      async function renderAllPages(){
        pagesWrapper.innerHTML = '';
        for (let p = 1; p <= pdf.numPages; p++) {
          const page = await pdf.getPage(p);
          const viewport = page.getViewport({ scale: 1 });
          const targetWidth = Math.min(container.clientWidth, 1200);
          const scale = targetWidth / viewport.width;
          const scaledViewport = page.getViewport({ scale });

          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = Math.floor(scaledViewport.width);
          canvas.height = Math.floor(scaledViewport.height);
          canvas.style.width = '100%';
          canvas.style.height = 'auto';
          canvas.style.background = '#0a1020';

          pagesWrapper.appendChild(canvas);
          await page.render({ canvasContext: ctx, viewport: scaledViewport }).promise;
        }
      }

      await renderAllPages();

      let resizeTO;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTO);
        resizeTO = setTimeout(renderAllPages, 180);
      }, { passive: true });
    }

    function openDoc(index){
      const doc = DOCS[index];
      if(!doc) return;
      activeIndex = index;
      currentNameEl.textContent = doc.title;

      if(doc.type === 'video'){
        const video = document.createElement('video');
        video.controls = true;
        video.playsInline = true;
        video.preload = 'metadata';
        const source = document.createElement('source');
        source.src = doc.file;
        source.type = 'video/mp4';
        video.appendChild(source);
        viewerContainer.innerHTML = '';
        viewerContainer.appendChild(video);

      } else if(doc.type === 'vimeo'){
        const iframe = document.createElement('iframe');
        iframe.src = doc.file;
        iframe.width = "100%";
        iframe.height = "100%";
        iframe.frameBorder = "0";
        iframe.allow = "autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share";
        iframe.allowFullscreen = true;
        viewerContainer.innerHTML = '';
        viewerContainer.appendChild(iframe);

      } else { // PDF
        if (isMobilePDFSensitive()){
          renderPDFWithPDFJS(doc.file);
        } else {
          const src = `${doc.file}#zoom=page-width&toolbar=0&navpanes=0&scrollbar=1&view=FitH`;
          viewerContainer.innerHTML = `<iframe src="${src}" title="${doc.title}"></iframe>`;
        }
      }

      setParam('file', doc.file);
      highlightActive();
    }

    searchEl.addEventListener('input', (e) => renderList(e.target.value));

    function init(){
      if (searchEl) searchEl.value = "";
      renderList("");

      const q = getParam('file');
      const idx = DOCS.findIndex(d => d.file === q);
      if(idx >= 0){
        openDoc(idx);
        const el = [...listEl.children].find(n => Number(n.dataset.index) === idx);
        if(el) el.scrollIntoView({block:'nearest'});
      } else if (DOCS.length > 0){
        openDoc(0); // abre el primero por defecto
      }
    }
    init();
  </script>
</body>
</html>
